import React, { useState, useEffect } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import axios from 'axios';

const Navbar = () => {
  const navigate = useNavigate();
  const [isMenuOpen, setIsMenuOpen] = useState(false);
  const [authState, setAuthState] = useState({
    isLoggedIn: false,
    isAdmin: false
  });

  useEffect(() => {
    const token = localStorage.getItem('authToken');
    const isAdmin = localStorage.getItem('isAdmin') === 'true';
    setAuthState({ isLoggedIn: !!token, isAdmin });
  }, []);

  const toggleMenu = () => setIsMenuOpen(!isMenuOpen);

  const handleLogout = async () => {
    try {
      await axios.post('/api/auth/logout', null, {
        headers: {
          Authorization: `Bearer ${localStorage.getItem('authToken')}`
        }
      });
    } catch (error) {
      console.error('Logout error:', error);
    } finally {
      localStorage.removeItem('authToken');
      localStorage.removeItem('isAdmin');
      setAuthState({ isLoggedIn: false, isAdmin: false });
      navigate('/login');
      toggleMenu();
    }
  };

  return (
    <nav className="navbar">
      <div className="nav-container">
        <Link to="/" className="logo">
          YourLogo
        </Link>

        <button 
          className={`hamburger ${isMenuOpen ? 'active' : ''}`} 
          onClick={toggleMenu}
          aria-label="Toggle navigation menu"
        >
          <span className="hamburger-line"></span>
          <span className="hamburger-line"></span>
          <span className="hamburger-line"></span>
        </button>

        <div className={`nav-links ${isMenuOpen ? 'active' : ''}`}>
          {authState.isLoggedIn ? (
            <>
              <Link to="/profile" className="nav-link" onClick={toggleMenu}>
                Profile
              </Link>
              {authState.isAdmin && (
                <span className="admin-badge">Admin</span>
              )}
              <button 
                onClick={handleLogout} 
                className="nav-link logout-button"
              >
                Logout
              </button>
            </>
          ) : (
            <>
              <Link to="/register" className="nav-link" onClick={toggleMenu}>
                Register
              </Link>
              <Link to="/login" className="nav-link" onClick={toggleMenu}>
                Login
              </Link>
            </>
          )}
        </div>
      </div>
    </nav>
  );
};

export default Navbar;

// Updated CSS Styles
const styles = `
  .navbar {
    background: #ffffff;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    padding: 1rem 0;
    position: fixed;
    width: 100%;
    top: 0;
    z-index: 1000;
  }

  /* ... (keep existing styles) ... */

  .admin-badge {
    background: #4CAF50;
    color: white;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.8rem;
    margin-left: 0.5rem;
  }

  .logout-button {
    background: none;
    border: none;
    color: #636e72;
    cursor: pointer;
    font: inherit;
    padding: 0.5rem 1rem;
    text-align: left;
    width: 100%;
  }

  .logout-button:hover {
    color: #0984e3;
    background: rgba(9, 132, 227, 0.1);
  }

  @media (min-width: 769px) {
    .logout-button {
      width: auto;
      text-align: center;
    }
  }
`;

// Inject styles
const styleSheet = document.createElement('style');
styleSheet.innerText = styles;
document.head.appendChild(styleSheet);